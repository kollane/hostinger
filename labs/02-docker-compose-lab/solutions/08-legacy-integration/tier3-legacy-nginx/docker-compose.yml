# Tier 3: Legacy Nginx Load Balancer
# Simuleerib: Eraldi Nginx reverse proxy serverit (bare-metal / AWS ALB)

services:
  legacy-nginx:
    image: nginx:1.25-alpine
    container_name: legacy-nginx-lb
    restart: unless-stopped
    ports:
      # Avalik endpoint (Internet → Load Balancer)
      - "8080:80"
    volumes:
      # Mount custom nginx konfiguratsioon
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    # Linux: Lisa host.docker.internal support
    extra_hosts:
      - "host.docker.internal:host-gateway"
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost/health"]
      interval: 10s
      timeout: 3s
      retries: 3

# MÄRKUS: ME EI DEFINEERI networks: sektsiooni!
# Legacy LB on eraldi, ühendub Docker rakenduste ga host võrgu kaudu
