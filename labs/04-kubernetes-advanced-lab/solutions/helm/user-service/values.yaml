# ==========================================================================
# Helm Values - User Service
# ==========================================================================
# Default väärtused. Override'i install ajal:
#   helm install user-service . -f values-prod.yaml
#   helm install user-service . --set replicaCount=5
# ==========================================================================

# Replica count
replicaCount: 2

# Image config
image:
  repository: user-service
  tag: "1.0"
  pullPolicy: IfNotPresent

# Service config
service:
  type: ClusterIP
  port: 3000
  targetPort: 3000

# Ingress config
ingress:
  enabled: true
  className: nginx
  host: kirjakast.cloud
  path: /api/users
  pathType: Prefix
  annotations: {}
    # nginx.ingress.kubernetes.io/rewrite-target: /
    # nginx.ingress.kubernetes.io/ssl-redirect: "false"

# Resources
resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 512Mi

# Autoscaling (HPA)
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 50
  targetMemoryUtilizationPercentage: 70

# Health checks
livenessProbe:
  httpGet:
    path: /health
    port: 3000
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

readinessProbe:
  httpGet:
    path: /ready
    port: 3000
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 2
  successThreshold: 1

# Environment variables
env:
  # Database
  DB_HOST: postgres-user
  DB_PORT: "5432"
  DB_NAME: user_service_db
  DB_USER: postgres
  # DB_PASSWORD from secret
  
  # App config
  NODE_ENV: production
  PORT: "3000"
  JWT_EXPIRES_IN: "24h"

# Secrets (create separate Secret resource)
secrets:
  jwtSecret: "your-jwt-secret-here"
  dbPassword: "postgres"

# NodeSelector (optional)
nodeSelector: {}
  # kubernetes.io/os: linux
  # node-type: worker

# Tolerations (optional)
tolerations: []
  # - key: "node-role"
  #   operator: "Equal"
  #   value: "worker"
  #   effect: "NoSchedule"

# Affinity (optional)
affinity: {}
  # podAntiAffinity:
  #   preferredDuringSchedulingIgnoredDuringExecution:
  #   - weight: 100
  #     podAffinityTerm:
  #       labelSelector:
  #         matchExpressions:
  #         - key: app
  #           operator: In
  #           values:
  #           - user-service
  #       topologyKey: kubernetes.io/hostname
